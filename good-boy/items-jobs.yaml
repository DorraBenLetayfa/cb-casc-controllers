removeStrategy:
  rbac: SYNC
  items: NONE

items:
  - kind: pipeline
    name: pipeline-scripted-1
    concurrentBuild: false
    properties:
      - pipelineTriggers:
          triggers:
            - cron:
                spec: H/30 * * * *
    definition:
      cpsFlowDefinition:
        sandbox: true
        script: |
          parallel([0, 1].collectEntries {b -> ["branch-$b", {
            podTemplate {
              node("maven") {
                stage('prep') {
                  sh 'curl https://ipinfo.io/'
                }
                stage('build') {
                  mockLoad 180
                }
            }
            checkpoint 'middle'
            podTemplate {
              node("maven") {
                stage('publish') {
                  archiveArtifacts allowEmptyArchive: true, artifacts: 'mock-artifact-*.txt'
                  fingerprint 'mock-artifact-*.txt'
                  junit 'mock-junit.xml'
                }
              }
            }
          }}]})
          build job: JOB_NAME, wait: false
  - kind: pipeline
    name: pipeline-scripted-2
    concurrentBuild: false
    properties:
      - pipelineTriggers:
          triggers:
            - cron:
                spec: H/30 * * * *
    definition:
      cpsFlowDefinition:
        sandbox: true
        script: |
          podTemplate {
            node(POD_LABEL) {
              stage('beginning') {
                sh 'sleep 30'
                sh 'date > date.txt'
                stash name: 'stuff', includes: 'date.txt'
              }
            }
          }
          checkpoint 'middle'
          podTemplate {
            node(POD_LABEL) {
              stage('end') {
                unstash 'stuff'
                sh 'cat date.txt'
                sh 'sleep 2m'
              }
            }
          }
